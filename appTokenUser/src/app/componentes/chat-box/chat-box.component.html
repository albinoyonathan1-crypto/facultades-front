<!-- Contenedor principal del ChatBox -->
<div *ngIf="chatCerrado" class="chat-box-container" [ngClass]="{'minimizado': chatMinimizado}">

    <!-- Cabecera del ChatBox con botÃ³n para minimizar/maximizar -->
    <div class="chat-box-header">
        <span>{{usuario?.nick}}</span>
        <span class="usuario-icon" [ngClass]="{'online': online, 'offline': online === false}"></span>
        <button (click)="toggleMinimizarChat()">
            {{ chatMinimizado ? 'ğŸ”¼' : 'ğŸ”½' }}
        </button>
        <button (click)="cerrarChat()">âŒ</button>
    </div>

    <!-- Contenedor de los mensajes (se oculta si estÃ¡ minimizado) -->
    <div *ngIf="!chatMinimizado" class="chat-box-messages">
        <div *ngFor="let mensaje of listaMensajes; trackBy: trackById" class="message"
            [ngClass]="{'sent': mensaje.idEmisor === idUsuarioActual, 'received': mensaje.idEmisor !== idUsuarioActual}">

            <p>{{ mensaje.fecha | date:'dd MMM yyyy' }}</p>
            <p #mensaje>{{ mensaje.contenido }}</p>

            <span *ngIf="mensaje.leida && mensaje.idEmisor === idUsuarioActual; else noVista">
                <svg style="color: rgb(0, 255, 157);" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                    class="bi bi-check-all" viewBox="0 0 16 16">
                    <path
                        d="M8.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L2.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093L8.95 4.992zm-.92 5.14.92.92a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 1 0-1.091-1.028L9.477 9.417l-.485-.486z" />
                </svg>
            </span>

            <ng-template #noVista>
                <span style="color: gray;">
                  
                    <svg style="color: rgb(255, 255, 255);" xmlns="http://www.w3.org/2000/svg" width="22" height="22"
                        fill="currentColor" class="bi bi-check-all" viewBox="0 0 16 16">
                        <path
                            d="M8.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L2.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093L8.95 4.992zm-.92 5.14.92.92a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 1 0-1.091-1.028L9.477 9.417l-.485-.486z" />
                    </svg>
                </span>
            </ng-template>
        </div>
    </div>

    <!-- Campo de entrada y botÃ³n de enviar (se oculta si estÃ¡ minimizado) -->
    <div *ngIf="!chatMinimizado" class="chat-box-input">
        <input type="text" placeholder="Escribe tu mensaje..." [(ngModel)]="nuevoMensaje" (keydown)="descontarCaracteres(this.nuevoMensaje, $event)" maxlength="250">
        <button [attr.disabled]="nuevoMensaje.trim() === '' ? true : null" (click)="enviarMensaje()">Enviar</button>
    </div>
    <p [attr.hidden]="nuevoMensaje.trim() === '' ? true : null">{{caracteresPermitidos}}</p>

    
    <div style="color: red;" *ngIf="mensajeExtenso">
        El mensaje es muy extenso.
    </div>
</div>

